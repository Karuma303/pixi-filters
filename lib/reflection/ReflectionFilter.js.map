{"version":3,"file":"ReflectionFilter.js","sources":["../../src/reflection/ReflectionFilter.ts"],"sourcesContent":["import { Filter, GlProgram, GpuProgram } from 'pixi.js';\r\nimport { vertex, wgslVertex } from '../defaults';\r\nimport fragment from './reflection.frag';\r\nimport source from './reflection.wgsl';\r\n\r\nimport type { FilterSystem, RenderSurface, Texture } from 'pixi.js';\r\n\r\n/** [MIN, MAX] */\r\ntype Range = [number, number] | Float32Array;\r\n\r\n/** Options for the ReflectionFilter constructor. */\r\nexport interface ReflectionFilterOptions\r\n{\r\n    /**\r\n     * `true` to reflect the image, `false` for waves-only\r\n     * @default true\r\n     */\r\n    mirror?: boolean;\r\n    /**\r\n     * Vertical position of the reflection point, `0.5` equates to the middle\r\n     * smaller numbers produce a larger reflection, larger numbers produce a smaller reflection\r\n     * @default 0.5\r\n     */\r\n    boundary?: number;\r\n    /**\r\n     * Starting and ending amplitude of waves\r\n     * @default [0,20]\r\n     */\r\n    amplitude?: Range;\r\n    /**\r\n     * Starting and ending length of waves\r\n     * @default [30,100]\r\n     */\r\n    waveLength?: Range;\r\n    /**\r\n     * Starting and ending alpha values\r\n     * @default [1,1]\r\n     */\r\n    alpha?: Range;\r\n    /**\r\n     * Time for animating position of waves\r\n     * @default 0\r\n     */\r\n    time?: number;\r\n}\r\n\r\n/**\r\n * Applies a reflection effect to simulate the reflection on water with waves.<br>\r\n * ![original](../screenshots/original.png)![filter](../screenshots/reflection.png)\r\n *\r\n * @class\r\n * @extends Filter\r\n */\r\nexport class ReflectionFilter extends Filter\r\n{\r\n    /** Default values for options. */\r\n    public static readonly DEFAULT_OPTIONS: ReflectionFilterOptions = {\r\n        mirror: true,\r\n        boundary: 0.5,\r\n        amplitude: [0, 20],\r\n        waveLength: [30, 100],\r\n        alpha: [1, 1],\r\n        time: 0,\r\n    };\r\n\r\n    public uniforms: {\r\n        uMirror: number;\r\n        uBoundary: number;\r\n        uAmplitude: Float32Array;\r\n        uWavelength: Float32Array;\r\n        uAlpha: Float32Array;\r\n        uTime: number;\r\n        uDimensions: Float32Array;\r\n    };\r\n\r\n    /**\r\n     * Time for animating position of waves\r\n     * @default 0\r\n     */\r\n    public time = 0;\r\n\r\n    /**\r\n     * @param options - Options for the ReflectionFilter constructor.\r\n     */\r\n    constructor(options?: ReflectionFilterOptions)\r\n    {\r\n        options = { ...ReflectionFilter.DEFAULT_OPTIONS, ...options };\r\n\r\n        const gpuProgram = GpuProgram.from({\r\n            vertex: {\r\n                source: wgslVertex,\r\n                entryPoint: 'mainVertex',\r\n            },\r\n            fragment: {\r\n                source,\r\n                entryPoint: 'mainFragment',\r\n            },\r\n        });\r\n        const glProgram = GlProgram.from({\r\n            vertex,\r\n            fragment,\r\n            name: 'reflection-filter',\r\n        });\r\n\r\n        super({\r\n            gpuProgram,\r\n            glProgram,\r\n            resources: {\r\n                reflectionUniforms: {\r\n                    uMirror: { value: options.mirror ? 1 : 0, type: 'f32' },\r\n                    uBoundary: { value: options.boundary, type: 'f32' },\r\n                    uAmplitude: { value: options.amplitude, type: 'vec2<f32>' },\r\n                    uWavelength: { value: options.waveLength, type: 'vec2<f32>' },\r\n                    uAlpha: { value: options.alpha, type: 'vec2<f32>' },\r\n                    uTime: { value: options.time, type: 'f32' },\r\n                    uDimensions: { value: new Float32Array(2), type: 'vec2<f32>' },\r\n                }\r\n            },\r\n        });\r\n\r\n        this.uniforms = this.resources.reflectionUniforms.uniforms;\r\n\r\n        Object.assign(this, options);\r\n    }\r\n\r\n    /**\r\n     * Override existing apply method in `Filter`\r\n     * @override\r\n     * @ignore\r\n     */\r\n    public override apply(\r\n        filterManager: FilterSystem,\r\n        input: Texture,\r\n        output: RenderSurface,\r\n        clearMode: boolean\r\n    ): void\r\n    {\r\n        this.uniforms.uDimensions[0] = input.frame.width;\r\n        this.uniforms.uDimensions[1] = input.frame.height;\r\n\r\n        this.uniforms.uTime = this.time;\r\n\r\n        filterManager.applyFilter(this, input, output, clearMode);\r\n    }\r\n\r\n    /**\r\n     * `true` to reflect the image, `false` for waves-only\r\n     * @default true\r\n     */\r\n    get mirror(): boolean { return this.uniforms.uMirror > 0.5; }\r\n    set mirror(value: boolean) { this.uniforms.uMirror = value ? 1 : 0; }\r\n\r\n    /**\r\n     * Vertical position of the reflection point, default is 50% (middle)\r\n     * smaller numbers produce a larger reflection, larger numbers produce a smaller reflection.\r\n     * @default 0.5\r\n     */\r\n    get boundary(): number { return this.uniforms.uBoundary; }\r\n    set boundary(value: number) { this.uniforms.uBoundary = value; }\r\n\r\n    /**\r\n     * Starting and ending amplitude of waves\r\n     * @default [0,20]\r\n     */\r\n    get amplitude(): Range { return Array.from(this.uniforms.uAmplitude) as Range; }\r\n    set amplitude(value: Range)\r\n    {\r\n        this.uniforms.uAmplitude[0] = value[0];\r\n        this.uniforms.uAmplitude[1] = value[1];\r\n    }\r\n\r\n    /**\r\n     * Starting amplitude of waves\r\n     * @default 0\r\n     */\r\n    get amplitudeStart(): number { return this.uniforms.uAmplitude[0]; }\r\n    set amplitudeStart(value: number) { this.uniforms.uAmplitude[0] = value; }\r\n\r\n    /**\r\n     * Starting amplitude of waves\r\n     * @default 20\r\n     */\r\n    get amplitudeEnd(): number { return this.uniforms.uAmplitude[1]; }\r\n    set amplitudeEnd(value: number) { this.uniforms.uAmplitude[1] = value; }\r\n\r\n    /**\r\n     * Starting and ending length of waves\r\n     * @default [30,100]\r\n     */\r\n    get waveLength(): Range { return Array.from(this.uniforms.uWavelength) as Range; }\r\n    set waveLength(value: Range)\r\n    {\r\n        this.uniforms.uWavelength[0] = value[0];\r\n        this.uniforms.uWavelength[1] = value[1];\r\n    }\r\n\r\n    /**\r\n     * Starting wavelength of waves\r\n     * @default 30\r\n     */\r\n    get wavelengthStart(): number { return this.uniforms.uWavelength[0]; }\r\n    set wavelengthStart(value: number) { this.uniforms.uWavelength[0] = value; }\r\n\r\n    /**\r\n     * Starting wavelength of waves\r\n     * @default 100\r\n     */\r\n    get wavelengthEnd(): number { return this.uniforms.uWavelength[1]; }\r\n    set wavelengthEnd(value: number) { this.uniforms.uWavelength[1] = value; }\r\n\r\n    /**\r\n     * Starting and ending alpha values\r\n     * @default [1,1]\r\n     */\r\n    get alpha(): Range { return Array.from(this.uniforms.uAlpha) as Range; }\r\n    set alpha(value: Range)\r\n    {\r\n        this.uniforms.uAlpha[0] = value[0];\r\n        this.uniforms.uAlpha[1] = value[1];\r\n    }\r\n\r\n    /**\r\n     * Starting wavelength of waves\r\n     * @default 1\r\n     */\r\n    get alphaStart(): number { return this.uniforms.uAlpha[0]; }\r\n    set alphaStart(value: number) { this.uniforms.uAlpha[0] = value; }\r\n\r\n    /**\r\n     * Starting wavelength of waves\r\n     * @default 1\r\n     */\r\n    get alphaEnd(): number { return this.uniforms.uAlpha[1]; }\r\n    set alphaEnd(value: number) { this.uniforms.uAlpha[1] = value; }\r\n}\r\n"],"names":["Filter","GpuProgram","wgslVertex","source","GlProgram","vertex","fragment"],"mappings":"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"}