{"version":3,"file":"TwistFilter.mjs","sources":["../../src/twist/TwistFilter.ts"],"sourcesContent":["import { Filter, GlProgram, GpuProgram, PointData } from 'pixi.js';\r\nimport { vertex, wgslVertex } from '../defaults';\r\nimport fragment from './twist.frag';\r\nimport source from './twist.wgsl';\r\n\r\n/** Options for the TwistFilter constructor. */\r\nexport interface TwistFilterOptions\r\n{\r\n    /**\r\n     * Padding for the filter area\r\n     * @default 20\r\n     */\r\n    padding?: number;\r\n    /**\r\n     * The radius of the twist\r\n     * @default 200\r\n     */\r\n    radius?: number;\r\n    /**\r\n     * The angle of the twist\r\n     * @default 4\r\n     */\r\n    angle?: number;\r\n    /**\r\n     * The `x` and `y` offset coordinates to change the position of the center of the circle of effect.\r\n     * This should be a size 2 array or an object containing `x` and `y` values, you cannot change types\r\n     * once defined in the constructor\r\n     * @default {x:0,y:0}\r\n     */\r\n    offset?: PointData;\r\n}\r\n\r\n/**\r\n * This filter applies a twist effect making display objects appear twisted in the given direction.<br>\r\n * ![original](../screenshots/original.png)![filter](../screenshots/twist.png)\r\n *\r\n * @class\r\n * @extends Filter\r\n */\r\nexport class TwistFilter extends Filter\r\n{\r\n    /** Default values for options. */\r\n    public static readonly DEFAULT_OPTIONS: TwistFilterOptions = {\r\n        padding: 20,\r\n        radius: 200,\r\n        angle: 4,\r\n        offset: { x: 0, y: 0 },\r\n    };\r\n\r\n    public uniforms: {\r\n        uTwist: Float32Array;\r\n        uOffset: PointData;\r\n    };\r\n\r\n    /**\r\n     * @param options - Options for the TwistFilter constructor.\r\n     */\r\n    constructor(options?: Partial<TwistFilterOptions>)\r\n    {\r\n        options = { ...TwistFilter.DEFAULT_OPTIONS, ...options };\r\n\r\n        const gpuProgram = GpuProgram.from({\r\n            vertex: {\r\n                source: wgslVertex,\r\n                entryPoint: 'mainVertex',\r\n            },\r\n            fragment: {\r\n                source,\r\n                entryPoint: 'mainFragment',\r\n            },\r\n        });\r\n\r\n        const glProgram = GlProgram.from({\r\n            vertex,\r\n            fragment,\r\n            name: 'twist-filter',\r\n        });\r\n\r\n        super({\r\n            gpuProgram,\r\n            glProgram,\r\n            resources: {\r\n                twistUniforms: {\r\n                    uTwist: {\r\n                        value: [options.radius ?? 0, options.angle ?? 0],\r\n                        type: 'vec2<f32>'\r\n                    },\r\n                    uOffset: {\r\n                        value: options.offset,\r\n                        type: 'vec2<f32>'\r\n                    },\r\n                }\r\n            },\r\n            ...options,\r\n        });\r\n\r\n        this.uniforms = this.resources.twistUniforms.uniforms;\r\n    }\r\n\r\n    /**\r\n     * The radius of the twist\r\n     * @default 200\r\n     */\r\n    get radius(): number { return this.uniforms.uTwist[0]; }\r\n    set radius(value: number) { this.uniforms.uTwist[0] = value; }\r\n\r\n    /**\r\n     * The angle of the twist\r\n     * @default 4\r\n     */\r\n    get angle(): number { return this.uniforms.uTwist[1]; }\r\n    set angle(value: number) { this.uniforms.uTwist[1] = value; }\r\n\r\n    /**\r\n     * The `x` offset coordinate to change the position of the center of the circle of effect\r\n     * @default 0\r\n     */\r\n    get offset(): PointData { return this.uniforms.uOffset; }\r\n    set offset(value: PointData) { this.uniforms.uOffset = value; }\r\n\r\n    /**\r\n     * The `x` offset coordinate to change the position of the center of the circle of effect\r\n     * @default 0\r\n     */\r\n    get offsetX(): number { return this.offset.x; }\r\n    set offsetX(value: number) { this.offset.x = value; }\r\n\r\n    /**\r\n     * The `y` offset coordinate to change the position of the center of the circle of effect\r\n     * @default 0\r\n     */\r\n    get offsetY(): number { return this.offset.y; }\r\n    set offsetY(value: number) { this.offset.y = value; }\r\n}\r\n"],"names":[],"mappings":"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"}