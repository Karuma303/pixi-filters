{"version":3,"file":"CRTFilter.js","sources":["../../src/crt/CRTFilter.ts"],"sourcesContent":["import { Filter, GlProgram, GpuProgram } from 'pixi.js';\r\nimport { vertex, wgslVertex } from '../defaults';\r\nimport fragment from './crt.frag';\r\nimport source from './crt.wgsl';\r\n\r\nimport type { FilterSystem, RenderSurface, Texture } from 'pixi.js';\r\n\r\n/** Options for the CRTFilter constructor. */\r\nexport interface CRTFilterOptions\r\n{\r\n    /**\r\n     * Bend of interlaced lines, higher value means more bend\r\n     * @default 1\r\n     */\r\n    curvature?: number,\r\n    /**\r\n     * Width of the interlaced lines\r\n     * @default 1\r\n     */\r\n    lineWidth?: number,\r\n    /**\r\n     * Contrast of interlaced lines\r\n     * @default 0.25\r\n     */\r\n    lineContrast?: number,\r\n    /**\r\n     * The orientation of the line:\r\n     *\r\n     * `true` create vertical lines, `false` creates horizontal lines\r\n     * @default false\r\n     */\r\n    verticalLine?: boolean,\r\n    /**\r\n     * For animating interlaced lines\r\n     * @default 0\r\n     */\r\n    time?: number,\r\n    /**\r\n     * Opacity/intensity of the noise effect between `0` and `1`\r\n     * @default 0.3\r\n     */\r\n    noise?: number,\r\n    /**\r\n     * The size of the noise particles\r\n     * @default 1\r\n     */\r\n    noiseSize?: number,\r\n    /**\r\n     * A seed value to apply to the random noise generation\r\n     * @default 0\r\n     */\r\n    seed?: number,\r\n    /**\r\n     * The radius of the vignette effect, smaller values produces a smaller vignette\r\n     * @default 0.3\r\n     */\r\n    vignetting?: number,\r\n    /**\r\n     * Amount of opacity on the vignette\r\n     * @default 1\r\n     */\r\n    vignettingAlpha?: number,\r\n    /**\r\n     * Blur intensity of the vignette\r\n     * @default 0.3\r\n     */\r\n    vignettingBlur?: number,\r\n}\r\n\r\n/**\r\n * The CRTFilter applies a CRT effect to an object.<br>\r\n * ![original](../screenshots/original.png)![filter](../screenshots/crt.png)\r\n *\r\n * @class\r\n * @extends Filter\r\n */\r\nexport class CRTFilter extends Filter\r\n{\r\n    /** Default values for options. */\r\n    public static readonly DEFAULT_OPTIONS: CRTFilterOptions = {\r\n        curvature: 1.0,\r\n        lineWidth: 1.0,\r\n        lineContrast: 0.25,\r\n        verticalLine: false,\r\n        noise: 0.0,\r\n        noiseSize: 1.0,\r\n        vignetting: 0.3,\r\n        vignettingAlpha: 1.0,\r\n        vignettingBlur: 0.3,\r\n        time: 0.0,\r\n        seed: 0.0,\r\n    };\r\n\r\n    public uniforms: {\r\n        uLine: Float32Array;\r\n        uNoise: Float32Array;\r\n        uVignette: Float32Array;\r\n        uSeed: number;\r\n        uTime: number;\r\n        uDimensions: Float32Array;\r\n    };\r\n\r\n    /**\r\n     * A seed value to apply to the random noise generation\r\n     * @default 0\r\n     */\r\n    public seed!: number;\r\n\r\n    /**\r\n     * Opacity/intensity of the noise effect between `0` and `1`\r\n     * @default 0.3\r\n     */\r\n    public time!: number;\r\n\r\n    /**\r\n     * @param options - Options for the CRTFilter constructor.\r\n     */\r\n    constructor(options?: CRTFilterOptions)\r\n    {\r\n        options = { ...CRTFilter.DEFAULT_OPTIONS, ...options };\r\n\r\n        const gpuProgram = GpuProgram.from({\r\n            vertex: {\r\n                source: wgslVertex,\r\n                entryPoint: 'mainVertex',\r\n            },\r\n            fragment: {\r\n                source,\r\n                entryPoint: 'mainFragment',\r\n            },\r\n        });\r\n\r\n        const glProgram = GlProgram.from({\r\n            vertex,\r\n            fragment,\r\n            name: 'crt-filter',\r\n        });\r\n\r\n        super({\r\n            gpuProgram,\r\n            glProgram,\r\n            resources: {\r\n                crtUniforms: {\r\n                    uLine: { value: new Float32Array(4), type: 'vec4<f32>' },\r\n                    uNoise: { value: new Float32Array(2), type: 'vec2<f32>' },\r\n                    uVignette: { value: new Float32Array(3), type: 'vec3<f32>' },\r\n                    uSeed: { value: options.seed, type: 'f32' },\r\n                    uTime: { value: options.time, type: 'f32' },\r\n                    uDimensions: { value: new Float32Array(2), type: 'vec2<f32>' },\r\n                }\r\n            },\r\n        });\r\n\r\n        this.uniforms = this.resources.crtUniforms.uniforms;\r\n\r\n        Object.assign(this, options);\r\n    }\r\n\r\n    /**\r\n     * Override existing apply method in `Filter`\r\n     * @override\r\n     * @ignore\r\n     */\r\n    public override apply(\r\n        filterManager: FilterSystem,\r\n        input: Texture,\r\n        output: RenderSurface,\r\n        clearMode: boolean\r\n    ): void\r\n    {\r\n        this.uniforms.uDimensions[0] = input.frame.width;\r\n        this.uniforms.uDimensions[1] = input.frame.height;\r\n\r\n        this.uniforms.uSeed = this.seed;\r\n        this.uniforms.uTime = this.time;\r\n\r\n        filterManager.applyFilter(this, input, output, clearMode);\r\n    }\r\n\r\n    /**\r\n     * Bend of interlaced lines, higher value means more bend\r\n     * @default 1\r\n     */\r\n    get curvature(): number { return this.uniforms.uLine[0]; }\r\n    set curvature(value: number) { this.uniforms.uLine[0] = value; }\r\n\r\n    /**\r\n     * Width of interlaced lines\r\n     * @default 1\r\n     */\r\n    get lineWidth(): number { return this.uniforms.uLine[1]; }\r\n    set lineWidth(value: number) { this.uniforms.uLine[1] = value; }\r\n\r\n    /**\r\n     * Contrast of interlaced lines\r\n     * @default 0.25\r\n     */\r\n    get lineContrast(): number { return this.uniforms.uLine[2]; }\r\n    set lineContrast(value: number) { this.uniforms.uLine[2] = value; }\r\n\r\n    /**\r\n     * The orientation of the line:\r\n     *\r\n     * `true` create vertical lines, `false` creates horizontal lines\r\n     * @default false\r\n     */\r\n    get verticalLine(): boolean { return this.uniforms.uLine[3] > 0.5; }\r\n    set verticalLine(value: boolean) { this.uniforms.uLine[3] = value ? 1 : 0; }\r\n\r\n    /**\r\n     * Opacity/intensity of the noise effect between `0` and `1`\r\n     * @default 0.3\r\n     */\r\n    get noise(): number { return this.uniforms.uNoise[0]; }\r\n    set noise(value: number) { this.uniforms.uNoise[0] = value; }\r\n\r\n    /**\r\n     * The size of the noise particles\r\n     * @default 0\r\n     */\r\n    get noiseSize(): number { return this.uniforms.uNoise[1]; }\r\n    set noiseSize(value: number) { this.uniforms.uNoise[1] = value; }\r\n\r\n    /**\r\n     * The radius of the vignette effect, smaller values produces a smaller vignette\r\n     * @default 0.3\r\n     */\r\n    get vignetting(): number { return this.uniforms.uVignette[0]; }\r\n    set vignetting(value: number) { this.uniforms.uVignette[0] = value; }\r\n\r\n    /**\r\n     * Amount of opacity of vignette\r\n     * @default 1\r\n     */\r\n    get vignettingAlpha(): number { return this.uniforms.uVignette[1]; }\r\n    set vignettingAlpha(value: number) { this.uniforms.uVignette[1] = value; }\r\n\r\n    /**\r\n     * Blur intensity of the vignette\r\n     * @default 0.3\r\n     */\r\n    get vignettingBlur(): number { return this.uniforms.uVignette[2]; }\r\n    set vignettingBlur(value: number) { this.uniforms.uVignette[2] = value; }\r\n}\r\n"],"names":["Filter","GpuProgram","wgslVertex","source","GlProgram","vertex","fragment"],"mappings":"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"}