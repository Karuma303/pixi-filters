{"version":3,"file":"BloomFilter.js","sources":["../../src/bloom/BloomFilter.ts"],"sourcesContent":["/* eslint-disable max-len */\r\nimport {\r\n    AlphaFilter,\r\n    BlurFilterPass,\r\n    deprecation,\r\n    FilterSystem,\r\n    PointData,\r\n    RenderSurface,\r\n    Texture,\r\n    TexturePool,\r\n} from 'pixi.js';\r\n\r\ntype DeprecatedBlurValue = number | PointData | number[];\r\n\r\n/** Options for the BloomFilter constructor. */\r\nexport interface BloomFilterOptions\r\n{\r\n    /**\r\n     * Sets the strength of the blur. If only a number is provided, it will assign to both x and y.\r\n     * @default {x:2,y:2}\r\n     */\r\n    strength?: PointData | number;\r\n    /**\r\n     * The quality of the blur.\r\n     * @default 4\r\n     */\r\n    quality?: number;\r\n    /**\r\n     * The resolution of the blurX & blurY filter.\r\n     * @default 1\r\n     */\r\n    resolution?: number;\r\n    /**\r\n     * The kernel size of the blur filter. Must be an odd number between 5 and 15 (inclusive).\r\n     * @default 5\r\n     */\r\n    kernelSize?: number;\r\n}\r\n\r\n/**\r\n * The BloomFilter applies a Gaussian blur to an object.\r\n * The strength of the blur can be set for x- and y-axis separately.<br>\r\n * ![original](../screenshots/original.png)![filter](../screenshots/bloom.png)\r\n *\r\n * @class\r\n * @extends Filter\r\n */\r\nexport class BloomFilter extends AlphaFilter\r\n{\r\n    /** Default values for options. */\r\n    public static readonly DEFAULT_OPTIONS: BloomFilterOptions = {\r\n        strength: { x: 2, y: 2 },\r\n        quality: 4,\r\n        resolution: 1,\r\n        kernelSize: 5\r\n    };\r\n\r\n    private _blurXFilter: BlurFilterPass;\r\n    private _blurYFilter: BlurFilterPass;\r\n    private _strength: PointData;\r\n\r\n    /**\r\n     * @param {BloomFilterOptions} options - Options for the BloomFilter constructor.\r\n     */\r\n    constructor(options?: BloomFilterOptions);\r\n    /**\r\n    * @deprecated since 6.0.0\r\n    *\r\n    * @param {number|PIXI.PointData|number[]} [blur=2] - Sets the strength of both the blurX and blurY properties simultaneously\r\n    * @param {number} [quality=4] - The quality of the blurX & blurY filter.\r\n    * @param {number} [resolution=1] - The resolution of the blurX & blurY filter.\r\n    * @param {number} [kernelSize=5] - The kernelSize of the blurX & blurY filter.Options: 5, 7, 9, 11, 13, 15.\r\n    */\r\n    constructor(blur?: DeprecatedBlurValue, quality?: number, resolution?: number, kernelSize?: number);\r\n    /** @ignore */\r\n    constructor(...args: [BloomFilterOptions?] | [DeprecatedBlurValue?, number?, number?, number?])\r\n    {\r\n        let options = args[0] ?? {};\r\n\r\n        if (typeof options === 'number' || Array.isArray(options) || ('x' in options && 'y' in options))\r\n        {\r\n            // eslint-disable-next-line max-len\r\n            deprecation('6.0.0', 'BloomFilter constructor params are now options object. See params: { strength, quality, resolution, kernelSize }');\r\n\r\n            let strength = options;\r\n\r\n            if (Array.isArray(strength)) strength = { x: strength[0], y: strength[1] };\r\n\r\n            options = { strength };\r\n\r\n            if (args[1] !== undefined) options.quality = args[1];\r\n            if (args[2] !== undefined) options.resolution = args[2];\r\n            if (args[3] !== undefined) options.kernelSize = args[3];\r\n        }\r\n\r\n        options = { ...BloomFilter.DEFAULT_OPTIONS, ...options } as BloomFilterOptions;\r\n\r\n        super();\r\n\r\n        this._strength = { x: 2, y: 2 };\r\n\r\n        if (options.strength)\r\n        {\r\n            if (typeof options.strength === 'number')\r\n            {\r\n                this._strength.x = options.strength;\r\n                this._strength.y = options.strength;\r\n            }\r\n            else\r\n            {\r\n                this._strength.x = options.strength.x;\r\n                this._strength.y = options.strength.y;\r\n            }\r\n        }\r\n\r\n        this._blurXFilter = new BlurFilterPass({\r\n            ...options,\r\n            horizontal: true,\r\n            strength: this.strengthX,\r\n        });\r\n\r\n        this._blurYFilter = new BlurFilterPass({\r\n            ...options,\r\n            horizontal: false,\r\n            strength: this.strengthY,\r\n        });\r\n\r\n        this._blurYFilter.blendMode = 'screen';\r\n\r\n        Object.assign(this, options);\r\n    }\r\n\r\n    /**\r\n     * Override existing apply method in `Filter`\r\n     * @override\r\n     * @ignore\r\n     */\r\n    public override apply(\r\n        filterManager: FilterSystem,\r\n        input: Texture,\r\n        output: RenderSurface,\r\n        clear: boolean,\r\n    ): void\r\n    {\r\n        const renderTarget = TexturePool.getSameSizeTexture(input);\r\n\r\n        filterManager.applyFilter(this, input, output, clear);\r\n        this._blurXFilter.apply(filterManager, input, renderTarget, true);\r\n        this._blurYFilter.apply(filterManager, renderTarget, output, false);\r\n\r\n        TexturePool.returnTexture(renderTarget);\r\n    }\r\n\r\n    /**\r\n     * Sets the strength of both the blurX and blurY properties simultaneously\r\n     * @default 2\r\n     */\r\n    get strength(): PointData { return this._strength; }\r\n    set strength(value: PointData | number)\r\n    {\r\n        this._strength = typeof value === 'number' ? { x: value, y: value } : value;\r\n        this._updateStrength();\r\n    }\r\n\r\n    /**\r\n     * Sets the strength of the blur on the `x` axis\r\n     * @default 2\r\n     */\r\n    get strengthX(): number { return this.strength.x; }\r\n    set strengthX(value: number)\r\n    {\r\n        this.strength.x = value;\r\n        this._updateStrength();\r\n    }\r\n\r\n    /**\r\n     * Sets the strength of the blur on the `y` axis\r\n     * @default 2\r\n     */\r\n    get strengthY(): number { return this.strength.y; }\r\n    set strengthY(value: number)\r\n    {\r\n        this.strength.y = value;\r\n        this._updateStrength();\r\n    }\r\n\r\n    private _updateStrength()\r\n    {\r\n        this._blurXFilter.blur = this.strengthX;\r\n        this._blurYFilter.blur = this.strengthY;\r\n    }\r\n\r\n    /**\r\n     * @deprecated since 6.0.0\r\n     *\r\n     * The strength of both the blurX and blurY properties simultaneously\r\n     * @default 2\r\n     * @see BloomFilter#strength\r\n     */\r\n    get blur(): number\r\n    {\r\n        deprecation('6.0.0', 'BloomFilter.blur is deprecated, please use BloomFilter.strength instead');\r\n\r\n        return this.strengthX;\r\n    }\r\n    set blur(value: number)\r\n    {\r\n        deprecation('6.0.0', 'BloomFilter.blur is deprecated, please use BloomFilter.strength instead');\r\n\r\n        this.strength = value;\r\n    }\r\n\r\n    /**\r\n     * @deprecated since 6.0.0\r\n     *\r\n     * The strength of the blurX property\r\n     * @default 2\r\n     * @see BloomFilter#strengthX\r\n     */\r\n    get blurX(): number\r\n    {\r\n        deprecation('6.0.0', 'BloomFilter.blurX is deprecated, please use BloomFilter.strengthX instead');\r\n\r\n        return this.strengthX;\r\n    }\r\n    set blurX(value: number)\r\n    {\r\n        deprecation('6.0.0', 'BloomFilter.blurX is deprecated, please use BloomFilter.strengthX instead');\r\n\r\n        this.strengthX = value;\r\n    }\r\n\r\n    /**\r\n     * @deprecated since 6.0.0\r\n     *\r\n     * The strength of the blurY property\r\n     * @default 2\r\n     * @see BloomFilter#strengthY\r\n     */\r\n    get blurY(): number\r\n    {\r\n        deprecation('6.0.0', 'BloomFilter.blurY is deprecated, please use BloomFilter.strengthY instead');\r\n\r\n        return this.strengthY;\r\n    }\r\n    set blurY(value: number)\r\n    {\r\n        deprecation('6.0.0', 'BloomFilter.blurY is deprecated, please use BloomFilter.strengthY instead');\r\n\r\n        this.strengthY = value;\r\n    }\r\n}\r\n"],"names":["AlphaFilter","deprecation","BlurFilterPass","TexturePool"],"mappings":"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"}